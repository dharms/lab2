<html>
<body>
<font size=4><div id="where"></div></font>
<img id="picture" src="">
<font size=3><div id="what"></div></font>
<font size=3><div id="inventory"></div></font>
<font size=3><div id="next"></div></font>
<br/>
<h3>Messages</h3>
<font size=3><div id="stuff"></div></font>
<input id="add_message" placeholder="Leave a message..." type="text" />
<button id="submit_message">Submit</button>

<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script>
$(function() {
    $("#where").html("booting...");
    where = "strong-hall";

    function refresh() {
    $.get("/" + where, function (data) {
        $("#where").html(data.text);
        $("#picture").attr("src","images/" + data.where);
        if (data.what == undefined || data.what.length == 0) {
        $("#what").html("");
        } else {
        $("#what").html("You can see : ");
        for(var i in data.what) {
        var item = data.what[i];
        $("#what").append(item);
        button = $("<button/><br/>");
        button.text("Take " + item);
        (function(button,where,item) {
         button.click(function() {
             $.ajax("/" + where + "/" + item,
                 { success : refresh
                 , type : "DELETE"
                 }
                 );
             refresh();
             });
         })(button,where,item);
        $("#what").append(button);
        }
        }

        $("#next").html("");
        for(var i in data.next) {
          $("#next").append(i);
          button = $("<button/><br/>");
          button.text("Go " + i);
          (function(button,dest) {
           button.click(function() {
               where = dest;
               refresh();
               });
           })(button,data.next[i]);
          $("#next").append(button);
        }

        $("#stuff").html("");
        for(var i in data.stuff) {
          $("#stuff").append(data.stuff[i]+'<br/>');
        }
    });

    $("#submit_message").on('click', function(){
        var message = $("#add_message").val();
        $("#add_message").val('');
        $.ajax("/" + where + "/" + message,
            { success : refresh
            , type : "POST"
            }
            );
        refresh();

        });


    $.get("/inventory",function (data) {
        if (data == undefined || data.length == 0) {
        $("#inventory").html("You are not carrying anything");
        } else {
        $("#inventory").html("You are carrying : ");
        for(var i in data) {
        var item = data[i];
        $("#inventory").append(item);
        button = $("<button/>");
        button.text("Drop " + item);
        (function(button,where,item) {
         button.click(function() {
             $.ajax("/" + where + "/" + item,
                 { success : refresh
                 , type : "PUT"
                 }
                 );
             refresh();
             });
         })(button,where,item);
        $("#inventory").append(button);
        }
        }
    });
    }

    refresh();

});
</script>
</body>
</html>
