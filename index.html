<html>
  <head>
    <title>KU</title>
  </head>
  <body>

    <div style="float:left; width:200; margin-right:25;" id="message_dock">
      <h2>Messages</h2>
      <div id="messages"></div>
      <input id="add_message" placeholder="Leave a message..." type="text" />
      <button id="submit_message">Submit</button>
    </div>

    <div style="float:left; width: 600;" id="image_dock">
      <h2><div id="where"></div></h2>
      <img id="picture" src="" width="600">
      <br/>
      <div id="what"></div>
      <br/>
      <div id="inventory"></div>
    </div>

    <div style="float:left; width:200; margin-left:25;" id="users_dock">
      <h2>Users</h2>
      <div id="users"></div>
      <div id="next"></div>
    </div>

    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script>
      $(function() {
        $("#where").html("booting...");
        where = "strong-hall";

        function refresh() {
          $.get("/" + where, function (data) {
            $("#where").html(data.text);
            $("#picture").attr("src","images/" + data.where);
            if (data.what == undefined || data.what.length == 0) {
              $("#what").html("");
              } else {
              $("#what").html("You can see : ");
              for(var i in data.what) {
                var item = data.what[i];
                //$("#what").append(item);
                button = $("<button/><br/>");
                  button.text("Take " + item);
                  (function(button,where,item) {
                    button.click(function() {
                      $.ajax("/" + where + "/" + item,
                      { success : refresh
                        , type : "DELETE"
                      }
                      );
                      refresh();
                    });
                  })(button,where,item);
                  $("#what").append(button);
                }
              }

              $("#next").html("");
              for(var i in data.next) {
                button = $("<button/><br/>");
                  button.text("Go " + i);
                  (function(button,dest) {
                    button.click(function() {
                      where = dest;
                      refresh();
                    });
                  })(button,data.next[i]);
                  $("#next").append(button);
                }

                $("#messages").html("");
                for(var i in data.messages) {
                  $("#messages").append(data.messages[i]+'<br/><br/>');
                }
              });

              $("#submit_message").on('click', function(){
                var message = $("#add_message").val();
                $("#add_message").val('');
                $.ajax("/" + where + "/" + message,
                { success : refresh
                , type : "POST"
              }
              );
              refresh();

            });


            $.get("/inventory",function (data) {
              if (data == undefined || data.length == 0) {
                $("#inventory").html("You are not carrying anything");
                } else {
                $("#inventory").html("Inventory : ");
                for(var i in data) {
                  var item = data[i];
                  //$("#inventory").append(item);
                  button = $("<button/>");
                    button.text("Drop " + item);
                    (function(button,where,item) {
                      button.click(function() {
                        $.ajax("/" + where + "/" + item,
                        { success : refresh
                        , type : "PUT"
                      }
                      );
                      refresh();
                    });
                  })(button,where,item);
                  $("#inventory").append(button);
                }
              }
            });
          }

          refresh();

        });
      </script>
    </body>
  </html>
